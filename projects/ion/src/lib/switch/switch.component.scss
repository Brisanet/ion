@import '../../styles/index.scss';
@import '../../styles/themes/theme.scss';

$sizes: sm md lg;
$states: active inactive;

$base-sm-size: 2px;
$base-md-size: 3px;
$base-lg-size: 4px;

@mixin switch-style($prefix) {
  background-color: ion-theme(switch-#{$prefix}-background-color);
  border: none;
  outline: none;

  &::before {
    background-color: ion-theme(switch-#{$prefix}-indicator-background-color);
  }
}

@mixin translateEllipse($side: 'half') {
  $base: 2;
  @if $side == 'full' {
    $base: 4;
  }

  &[size='sm']::before {
    transform: translateX(calc($base-sm-size * $base));
  }

  &[size='md']::before {
    transform: translateX(calc($base-md-size * $base));
  }

  &[size='lg']::before {
    transform: translateX(calc($base-lg-size * $base));
  }
}

@mixin addShadowAnimation($base, $changeName: 'animateShadow') {
  animation: $changeName 300ms ease-in-out;

  @keyframes #{$changeName} {
    0% {
      box-shadow: none;
    }
    20% {
      box-shadow: 0 0 0 calc(ion-theme(switch-size-#{$base}-indicator-size) * 2)
        $primary-1;
      background: $primary-4;
    }
    100% {
      box-shadow: none;
    }
  }
}

.ion-switch {
  display: flex;
  cursor: pointer;
  position: relative;
  transition: all ease-out 100ms;

  &:focus-visible {
    @include focus;
  }

  &::before {
    content: '';
    position: absolute;
    border-radius: 50%;
    transition: all 0.3s cubic-bezier(0.78, 0.14, 0.15, 0.86);
  }

  @each $size in $sizes {
    &[size='#{$size}'] {
      width: ion-theme(switch-size-#{$size}-width);
      height: ion-theme(switch-size-#{$size}-height);
      border-radius: ion-theme(switch-size-#{$size}-border-radius);

      &::before {
        top: ion-theme(switch-size-#{$size}-indicator-distance);
        left: ion-theme(switch-size-#{$size}-indicator-distance);
        width: ion-theme(switch-size-#{$size}-indicator-size);
        height: ion-theme(switch-size-#{$size}-indicator-size);
      }

      &.ion-switch--inactive {
        @include addShadowAnimation($size, shadowAnimationOut);
      }

      &.ion-switch--active {
        @include addShadowAnimation($size);
        @include translateEllipse('full');

        &::before {
          transition: all 0.3s cubic-bezier(0.78, 0.14, 0.15, 0.86);
        }
      }
    }
  }

  @each $state in $states {
    &.ion-switch--#{$state} {
      @debug ion-switch--#{$state};
      @include switch-style($state);

      &:hover {
        @include switch-style(#{$state}-hover);
      }

      &:active {
        @include switch-style(#{$state}-active);
        @include translateEllipse();
      }

      &:disabled {
        @include switch-style(#{$state}-disabled);
        cursor: not-allowed;
      }
    }
  }
}
